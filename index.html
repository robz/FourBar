<html>
<style>
body {
    text-align: center;
}
</style>
<h1>Four-bar simulator</h1>
click and drag gray area<br/><br/>
<div id="container"></div>
<script src="../Plot.js/plot.js"></script>
<script src="fourbar.js"></script>
<script>
(function () {
    "use strict";

    var plot = new Plot({
            container: "container",
            pixelWidth: 500,
            pixelHeight: 400,
            minX: -8,
            maxX: 5*4-8,
            minY: -8,
            maxY: 4*3-4,
            pointRadius: 0.2,
            lineWidth: 0.1,
            drawColor: "blue",
            backgroundColor: "lightGray"
        }),
        
        count = 0,
        maxCount = 200,
        speed = 2,
        
        blockHeight = 1,
        blockWidth = 1.5,
        
        fb = createFourBar(1, 4, 3, 3, 6, Math.PI+Math.PI/6);
    
    plot.drawPoint(0, 0);
    plot.storeBackground();
    
    var mousePressed = false,
        pressStartX = null;

    var drawPath = function () {
        var points = [];
        
        for (var i = 0; i < maxCount+1; i++) {
            var theta2 = i * Math.PI * 2 / maxCount;
            fb.calcPositions(theta2);
            points.push([fb.x5, fb.y5]);
        }

        plot.clear();
        plot.drawPoint(0, 0);
        plot.drawPath(points, {drawColor:"red"});
        plot.storeBackground();
    };
    
    plot.setMouseDown(function (x, y) {
        var dist = Math.sqrt((x - fb.d) * (x - fb.d) + (y - 0) * (y - 0));
        if (x > fb.d - blockWidth/2 && x < fb.d + blockWidth/2 && 
            y > -blockHeight/2 && y < blockWidth/2) 
        {
            mousePressed = true;
            pressStartX = x;
        }
    });
    
    plot.setMouseUp(function (x, y) {
        if (mousePressed) {
            var deltaX = x - pressStartX;
            fb.d += deltaX;
            try {
                drawPath();
            } catch (e) {
                fb.d -= deltaX;
            }
        }
        mousePressed = false;
    });
    
    plot.setMouseMove(function (x, y) {
        if (mousePressed) {
            var deltaX = x - pressStartX;
            fb.d += deltaX;
            try {
                drawPath();
                pressStartX = x;
            } catch (e) {
                fb.d -= deltaX;
            }
        }
    });
    
    var drawFourBar = function () {
        plot.restoreToBackground();
        
        plot.drawRect(fb.d - blockWidth/2, -blockHeight/2, blockWidth, blockHeight, 
            {drawColor:"gray"});
        plot.drawPoint(fb.d, 0);
        plot.drawLine(0, 0, fb.d, 0);
        
        plot.drawPoint(fb.x2, fb.y2, {drawColor:"green"});
        plot.drawLine(0, 0, fb.x2, fb.y2);
        
        plot.drawPoint(fb.x3, fb.y3, {drawColor:"green"});
        plot.drawLine(fb.x2, fb.y2, fb.x3, fb.y3, {drawColor:"green"});
        plot.drawLine(fb.x3, fb.y3, fb.d, 0);
        
        plot.drawPoint(fb.x5, fb.y5, {drawColor:"green"});
        plot.drawLine(fb.x3, fb.y3, fb.x5, fb.y5, {drawColor:"green"});
        
        plot.drawLine(fb.x2, fb.y2, fb.x5, fb.y5, {drawColor:"green"});
    };

    setInterval(function () {
        var theta2 = count * Math.PI * 2 / maxCount;
        
        fb.calcPositions(theta2);
        drawFourBar();

        count = (count + speed) % maxCount;
    }, 30);
    
    drawPath();
}());
</script>
</html>